# Reclaim repository-specific configuration

# Inherits all defaults from default.yaml

# Truth checks for Reclaim (app/ subdirectory)
truth_checks:
  - name: npm ci
    command: npm ci
  - name: TypeScript check
    command: npx tsc --noEmit
  - name: Unit tests
    command: npx vitest run --passWithNoTests

# Repository-specific rules
repo_rules:
  - Never force push to branches
  - Never delete branches
  - Never modify Supabase migrations or database schema
  - Never touch auth flow unless milestone explicitly targets it
  - Default to small diffs, max 3 files/150 lines unless escalation justified
  - Do NOT disable tests, suppress TypeScript errors, or hide crashes with broad try/catch
  - Do NOT remove features unless explicitly approved
  - If uncertain, search the repo before editing
  - Never invent file paths, exports, or schema fields
  - Never downgrade hasOnboarded once true
  - For UUID PK tables: omit id and let DB generate it
  - Verify post-insert row counts; treat 0 rows as an error

# Milestone queue
milestones:
  - id: milestone-001
    title: "Training Goals: Engine-Driven Outcome Preview Panel"
    type: feat
    status: todo
    target_files:
      - "app/src/screens/**"
      - "app/src/components/**"
      - "app/src/lib/training/**"
      - "app/src/lib/**"
    acceptance:
      - "cd app && npm ci"
      - "cd app && npx tsc --noEmit"
      - "cd app && npx vitest run --passWithNoTests"
    stop_feature: false
    created_at: "2026-01-20"
    spec:
      objective: >
        Add a live “Outcome Preview” panel to the Training Goals selection UI that shows users
        what their CURRENT settings will actually generate, derived directly from the SAME engine used
        for real generation (dry-run, no persistence).
      core_principle: >
        PREVIEW MUST NEVER LIE. Preview must match what the generator would produce for the same settings.
      scope_in:
        - "Persistent preview panel on Training Goals screen; updates instantly"
        - "Compute preview via dry-run of real generator (no DB writes, no side effects)"
        - "Summarize from real output: rep ranges, set counts, grouping style, AMRAP presence, example snippet"
        - "Unit tests: preview summary matches summary of real generation for same settings"
      scope_out:
        - "No changes to training engine behavior"
        - "No DB schema/migrations"
        - "No auth changes"
      implementation_approach:
        engine_dry_run:
          requirements:
            - "Call the same generator used for real sessions/programs"
            - "No DB inserts, no persistence, no side effects"
            - "If a day/context is required, use a deterministic default (e.g., next scheduled day)"
        preview_summary_computation:
          must_include:
            - "Observed rep ranges"
            - "Observed set counts (main + accessory)"
            - "Grouping philosophy inferred from actual ordering"
            - "AMRAP presence"
            - "Example snippet taken from generated output"
      acceptance_criteria:
        - "Preview visible before saving goals"
        - "Preview derived from generator output (no heuristics)"
        - "Preview never contradicts generated plan"
        - "No training behavior changes"
        - "tsc + vitest pass"

  - id: milestone-002
    title: "Training Setup: Muscle Frequency Preference (1x vs 2x per week)"
    type: feat
    status: todo
    target_files:
      - "app/src/screens/**"
      - "app/src/lib/training/**"
      - "app/src/state/**"
      - "app/src/services/**"
    acceptance:
      - "cd app && npm ci"
      - "cd app && npx tsc --noEmit"
      - "cd app && npx vitest run --passWithNoTests"
    stop_feature: false
    created_at: "2026-01-20"
    spec:
      objective: >
        Add a simple user preference (once/twice/auto) for weekly muscle frequency and use it as a constraint/bias
        in split selection/scheduling, with guardrails and graceful fallback when infeasible.
      scope_in:
        - "UI control once/twice/auto; default auto"
        - "Persist preference with existing training settings"
        - "Bias split selection: twice -> Upper/Lower or Full Body (depending on days/week)"
        - "If infeasible, fall back to auto and surface note"
        - "Update preview (M1) to reflect frequency intent"
      scope_out:
        - "No advanced customization beyond frequency"
        - "No DB schema/migrations"
        - "No auth changes"
      acceptance_criteria:
        - "Preference persists"
        - "When feasible, generated split reflects choice"
        - "When infeasible, app explains and remains functional"
        - "Existing users on auto unaffected"
        - "tsc + vitest pass"
